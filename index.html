<!DOCTYPE html>

<html>
<head>
  <title>main.rs</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.rs</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>The Thermal Colorization Engine.</p>
<p>This is a single executable that colorizes point clouds with thermal imagery data.
Specifically, it takes a <a href="http://www.riegl.com/">Riegl</a> <a href="http://www.riegl.com/products/software-packages/riscan-pro/">RiSCAN
Pro</a> project, a directory of
<a href="http://www.infratec.eu/">InfraTec</a> imagery, and colorizes the scans in the RiSCAN Pro project
with the InfraTec imagery. This won’t Just Work — the RiSCAN Pro project needs to be set up a
certain way, and the InfraTec imagery must be named in a way that the images can be linked back
to their scan positions. Since this is a one-off project, you’ll have to read this source (and
the source of <a href="https://github.com/gadomski/riscan-pro">riscan-pro</a> to figure out what that
setup looks like.</p>
<p>The source for <strong>tce</strong> is commented in the literate programming style, and the
<a href="https://github.com/jashkenas/docco">docco</a> output is available at
<a href="https://gadomski.github.io/tce">https://gadomski.github.io/tce</a>.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><a href="https://github.com/kbknapp/clap-rs">Clap</a> is our command-line argument parser.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> clap;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><a href="https://github.com/gadomski/irb-rs">irb</a> reads data from InfraTec thermal imagery.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> irb;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><a href="https://github.com/gadomski/las-rs">las</a> reads and writes
<a href="https://www.asprs.org/committee-general/laser-las-file-format-exchange-activities.html">las</a>
point cloud data. We use it in this executable to write data only.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> las;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We use <a href="https://github.com/Ogeon/palette">palette</a> to transform temperature values in to RGB
colors, which are then applied to the output las points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> palette;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The <a href="https://github.com/gadomski/riscan-pro">riscan-pro</a> crate reads RiSCAN Pro xml files.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> riscan_pro;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><a href="https://github.com/gadomski/rivlib-rs">scanifc</a> reads data from Riegl rxp files.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> scanifc;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>We bring in various names to make their later usages less verbose.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">use</span> clap::{App, ArgMatches};
<span class="hljs-keyword">use</span> irb::Irb;
<span class="hljs-keyword">use</span> las::point::Color;
<span class="hljs-keyword">use</span> palette::{Gradient, Rgb};
<span class="hljs-keyword">use</span> riscan_pro::{CameraCalibration, MountCalibration, Point, Project, ScanPosition, Socs};
<span class="hljs-keyword">use</span> riscan_pro::scan_position::Image;
<span class="hljs-keyword">use</span> scanifc::point3d::Stream;
<span class="hljs-keyword">use</span> std::fs;
<span class="hljs-keyword">use</span> std::io::Write;
<span class="hljs-keyword">use</span> std::path::{Path, PathBuf};
<span class="hljs-keyword">use</span> std::<span class="hljs-built_in">u16</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The main function does all of the work in our executable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Our command-line configuration is stored in cli.yml, to keep this main code file less noisy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> yaml = load_yaml!(<span class="hljs-string">"cli.yml"</span>);
    <span class="hljs-keyword">let</span> matches = App::from_yaml(yaml).get_matches();
    <span class="hljs-built_in">print!</span>(<span class="hljs-string">"Configuring..."</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><code>print!</code>, on its own, doesn’t flush stdout, so we have to manually flush to ensure our
“Configuring…” text is printed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    std::io::stdout().flush().unwrap();</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Creates a <code>Config</code> object from the command-line switches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> config = Config::new(&amp;matches);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"done."</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>The user can specify which scan positions are to be processed via the command line, or by
default we process them all.</p>
<p>We could have put all of this work into its own function, e.g. <code>Config::run</code>, but we break
it apart so we can print useful information to the user without littering our actual
business logic with lots of <code>println!</code> statements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> scan_position <span class="hljs-keyword">in</span> config.scan_positions() {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Colorizing {}:"</span>, scan_position.name);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>A translation is simply a infile-&gt;outfile map (see <code>Translation</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> translations = config.translations(scan_position);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The translation might be empty if there is no imagery available <em>and</em> the user only
asked for temperature-attributed points. It also might be empty if there are no scans in
the scan position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> translations.is_empty() {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"  - No translations found"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">for</span> translation <span class="hljs-keyword">in</span> translations {
                <span class="hljs-built_in">println!</span>(
                    <span class="hljs-string">"  - Translation:\n    - Infile: {}\n    - Outfile: {}"</span>,
                    translation.infile.display(),
                    translation.outfile.display()
                );</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>This is where the actual colorization takes place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                config.colorize(scan_position, &amp;translation);
            }
        }
    }
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Complete!"</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Essentially a map of our command-line options onto Rust types, with some processing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Config</span></span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The directory that will be searched for thermal imagery.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    image_dir: PathBuf,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Should points without thermal data be written to the output?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    keep_without_thermal: <span class="hljs-built_in">bool</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>The directory that will hold all output files.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    las_dir: PathBuf,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The maximum reflectance value, used when scaling reflectance values to intensity values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    max_reflectance: <span class="hljs-built_in">f32</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>The minimum reflectance value, used when scaling reflectance values to intensity values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    min_reflectance: <span class="hljs-built_in">f32</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>The active <code>riscan_pro::Project</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    project: Project,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Should the thermal images be rotated 90°? Some of our projects need this option.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rotate: <span class="hljs-built_in">bool</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>A list of scan position names to process. If None, all scan position names from the project
will be processed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scan_position_names: <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt;,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>When reading rxp data, should we only read points that have been synced to an external pps
signal? If the data were collected without a GNSS, you probably want sync_to_pps to be
false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sync_to_pps: <span class="hljs-built_in">bool</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>The gradient used to map temperate values onto rgb colors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    temperature_gradient: Gradient&lt;Rgb&gt;,</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Should output las files be named after their scan position (true) or from the source rxp
(false). Note that the engine will fail if this is true but there are more than one scan per
scan position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    use_scanpos_names: <span class="hljs-built_in">bool</span>,
}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>All the bits and parts necessary to lookup a temperature value for a given point in the
Scanner’s Own Coordinate System (SOCS).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ImageGroup</span></span>&lt;<span class="hljs-symbol">'a</span>&gt; {
    camera_calibration: &amp;<span class="hljs-symbol">'a</span> CameraCalibration,
    image: &amp;<span class="hljs-symbol">'a</span> Image,
    irb: Irb,
    mount_calibration: &amp;<span class="hljs-symbol">'a</span> MountCalibration,
    rotate: <span class="hljs-built_in">bool</span>,
}</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>A simple infile-&gt;outfile map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Translation</span></span> {
    infile: PathBuf,
    outfile: PathBuf,
}

<span class="hljs-keyword">impl</span> Config {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Creates a new <code>Config</code> from the command-line arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(matches: &amp;ArgMatches) -&gt; Config {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Here, and elsewhere, we <code>unwrap</code> errors instead of handling them gracefully. If/when
this executable matures, we might handle these errors instead of just unwrapping them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> project = Project::from_path(matches.value_of(<span class="hljs-string">"PROJECT"</span>).unwrap()).unwrap();
        <span class="hljs-keyword">let</span> image_dir = PathBuf::from(matches.value_of(<span class="hljs-string">"IMAGE_DIR"</span>).unwrap());
        <span class="hljs-keyword">let</span> las_dir = Path::new(matches.value_of(<span class="hljs-string">"LAS_DIR"</span>).unwrap()).to_path_buf();
        <span class="hljs-keyword">let</span> min_reflectance = value_t!(matches, <span class="hljs-string">"min-reflectance"</span>, <span class="hljs-built_in">f32</span>).unwrap();
        <span class="hljs-keyword">let</span> max_reflectance = value_t!(matches, <span class="hljs-string">"max-reflectance"</span>, <span class="hljs-built_in">f32</span>).unwrap();
        <span class="hljs-keyword">let</span> min_temperature = value_t!(matches, <span class="hljs-string">"min-temperature"</span>, <span class="hljs-built_in">f32</span>).unwrap();
        <span class="hljs-keyword">let</span> max_temperature = value_t!(matches, <span class="hljs-string">"max-temperature"</span>, <span class="hljs-built_in">f32</span>).unwrap();</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Blue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> min_temperature_color = Rgb::new(<span class="hljs-number">0.0</span>, <span class="hljs-number">0</span>., <span class="hljs-number">1.0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Red</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> max_temperature_color = Rgb::new(<span class="hljs-number">1.0</span>, <span class="hljs-number">0</span>., <span class="hljs-number">0</span>.);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Creates a gradient whose domain goes from min_temperature-&gt;max_temperature, and range
goes from blue-&gt;red.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> temperature_gradient = Gradient::with_domain(<span class="hljs-built_in">vec!</span>[
            (min_temperature, min_temperature_color),
            (max_temperature, max_temperature_color),
        ]);
        Config {
            image_dir: image_dir,
            keep_without_thermal: matches.is_present(<span class="hljs-string">"keep-without-thermal"</span>),
            las_dir: las_dir,
            max_reflectance: max_reflectance,
            min_reflectance: min_reflectance,
            project: project,
            rotate: matches.is_present(<span class="hljs-string">"rotate"</span>),
            scan_position_names: matches.values_of(<span class="hljs-string">"scan-position"</span>).map(|values| {
                values.map(|name| name.to_string()).collect()
            }),
            sync_to_pps: matches.is_present(<span class="hljs-string">"sync-to-pps"</span>),
            temperature_gradient: temperature_gradient,
            use_scanpos_names: matches.is_present(<span class="hljs-string">"use-scanpos-names"</span>),
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Returns all translation for the scan position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">translations</span></span>(&amp;<span class="hljs-keyword">self</span>, scan_position: &amp;ScanPosition) -&gt; <span class="hljs-built_in">Vec</span>&lt;Translation&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>The rxp paths are extracted from the RiSCAN Pro xml file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> paths = scan_position.singlescan_rxp_paths(&amp;<span class="hljs-keyword">self</span>.project);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>If we’ve asked to use the scan position name as the output file name, but there are more
than one scan for this scan position, panic. This should eventually be turned into an
error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.use_scanpos_names &amp;&amp; paths.len() &gt; <span class="hljs-number">1</span> {
            <span class="hljs-built_in">panic!</span>(
                <span class="hljs-string">"--use-scanpos-names was provided, but there are {} rxp files for scan position {}"</span>,
                paths.len(),
                scan_position.name
            );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Convert the vector of paths into a vector of translations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        paths
            .into_iter()
            .map(|path| {
                Translation {
                    outfile: <span class="hljs-keyword">self</span>.outfile(scan_position, &amp;path),
                    infile: path,
                }
            })
            .collect()
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Colorize all the points in an infile, and write them out to an outfile.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">colorize</span></span>(&amp;<span class="hljs-keyword">self</span>, scan_position: &amp;ScanPosition, translation: &amp;Translation) {
        <span class="hljs-keyword">use</span> std::<span class="hljs-built_in">f64</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Extract all the images that can be used to colorize points in this scan position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> image_groups = <span class="hljs-keyword">self</span>.image_groups(scan_position);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Open the rxp file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> stream = Stream::from_path(&amp;translation.infile)
            .sync_to_pps(<span class="hljs-keyword">self</span>.sync_to_pps)
            .open()
            .unwrap();</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Open the output las file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> writer = las::Writer::from_path(&amp;translation.outfile, <span class="hljs-keyword">self</span>.las_header()).unwrap();</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Read each point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> point <span class="hljs-keyword">in</span> stream {
            <span class="hljs-keyword">let</span> point = point.expect(<span class="hljs-string">"could not read rxp point"</span>);
            <span class="hljs-keyword">let</span> socs = Point::socs(point.x, point.y, point.z);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Compute all temperatures for this point. Because there is image overlap, a single
point might have zero, one, or more temperatures.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> temperatures = image_groups
                .iter()
                .filter_map(|image_group| image_group.temperature(&amp;socs))
                .collect::&lt;<span class="hljs-built_in">Vec</span>&lt;_&gt;&gt;();
            <span class="hljs-keyword">let</span> temperature = <span class="hljs-keyword">if</span> temperatures.is_empty() {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>If there are no temperatures, but we’ve asked to keep points without thermal
information, set the temperature to NaN.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.keep_without_thermal {
                    <span class="hljs-built_in">f64</span>::NAN
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Otherwise, go to the next point in the rxp stream without writing a point to the
las file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">continue</span>;
                }
            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Average all of the temperatures to get a single value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                temperatures.iter().sum::&lt;<span class="hljs-built_in">f64</span>&gt;() / temperatures.len() <span class="hljs-keyword">as</span> <span class="hljs-built_in">f64</span>
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Convert the socs point to a global point (GLCS).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> glcs = socs.to_prcs(scan_position.sop).to_glcs(<span class="hljs-keyword">self</span>.project.pop);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Create the las point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> point = las::Point {
                x: glcs.x,
                y: glcs.y,
                z: glcs.z,</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Las intensity values only go from 0 to 65535, so we need to scale our
floating-point reflectance value to an intensity value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                intensity: <span class="hljs-keyword">self</span>.to_intensity(point.reflectance),</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Looks up the color for the temperature. NAN goes to black.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                color: <span class="hljs-literal">Some</span>(<span class="hljs-keyword">self</span>.to_color(temperature <span class="hljs-keyword">as</span> <span class="hljs-built_in">f32</span>)),</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Sets the gps_time field to the temperature value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                gps_time: <span class="hljs-literal">Some</span>(temperature),</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>We don’t really care about the rest of the point attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                ..<span class="hljs-built_in">Default</span>::<span class="hljs-keyword">default</span>()
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Writes the las point out to the outfile.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            writer.write(&amp;point).expect(<span class="hljs-string">"could not write las point"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>las::Writer implements <code>Drop</code>, meaning that the las header gets rewritten with the
correct values when <code>writer</code> goes out of scope.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Returns all scan positions, as determined by (a) the names provided on the command line or
(b) all scan positions in the project, if none were specified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">scan_positions</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Vec</span>&lt;&amp;ScanPosition&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> scan_positions: <span class="hljs-built_in">Vec</span>&lt;_&gt; = <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(names) = <span class="hljs-keyword">self</span>.scan_position_names.as_ref() {
            names
                .iter()
                .map(|name| <span class="hljs-keyword">self</span>.project.scan_positions.get(name).unwrap())
                .collect()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">self</span>.project.scan_positions.values().collect()
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Sorts the scan positions to ensure they’re processed in a reasonable order, instead of
pseudo-randomly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scan_positions.sort_by_key(|s| &amp;s.name);
        scan_positions
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Converts a temperature value to a color.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">to_color</span></span>(&amp;<span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">f32</span>) -&gt; Color {
        <span class="hljs-keyword">let</span> color = <span class="hljs-keyword">self</span>.temperature_gradient.get(n);
        Color {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>The gradient returns color values from 0 to 1, floating point, so they need to be
scaled to the u16 values expected by the las format.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            red: (<span class="hljs-built_in">u16</span>::MAX <span class="hljs-keyword">as</span> <span class="hljs-built_in">f32</span> * color.red) <span class="hljs-keyword">as</span> <span class="hljs-built_in">u16</span>,
            green: (<span class="hljs-built_in">u16</span>::MAX <span class="hljs-keyword">as</span> <span class="hljs-built_in">f32</span> * color.green) <span class="hljs-keyword">as</span> <span class="hljs-built_in">u16</span>,
            blue: (<span class="hljs-built_in">u16</span>::MAX <span class="hljs-keyword">as</span> <span class="hljs-built_in">f32</span> * color.blue) <span class="hljs-keyword">as</span> <span class="hljs-built_in">u16</span>,
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Scales a floating-point reflectance value to a integer intensity value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">to_intensity</span></span>(&amp;<span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">f32</span>) -&gt; <span class="hljs-built_in">u16</span> {
        (<span class="hljs-built_in">u16</span>::MAX <span class="hljs-keyword">as</span> <span class="hljs-built_in">f32</span> * (n - <span class="hljs-keyword">self</span>.min_reflectance) /
             (<span class="hljs-keyword">self</span>.max_reflectance - <span class="hljs-keyword">self</span>.min_reflectance)) <span class="hljs-keyword">as</span> <span class="hljs-built_in">u16</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Creates the las header for our output files.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">las_header</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; las::Header {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> header = las::Header::<span class="hljs-keyword">default</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Point format 3 includes both gps time and color.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        header.point_format = <span class="hljs-number">3</span>.into();
        header.transforms = las::Vector {
            x: las::Transform {
                scale: <span class="hljs-number">0.001</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>The project’s POP works well as a scale factor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                offset: <span class="hljs-keyword">self</span>.project.pop[(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)],
            },
            y: las::Transform {
                scale: <span class="hljs-number">0.001</span>,
                offset: <span class="hljs-keyword">self</span>.project.pop[(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)],
            },
            z: las::Transform {
                scale: <span class="hljs-number">0.001</span>,
                offset: <span class="hljs-keyword">self</span>.project.pop[(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)],
            },
        };
        header
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Returns all images (with associated calibration structures) for the provided scan position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">image_groups</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;(&amp;<span class="hljs-symbol">'a</span> <span class="hljs-keyword">self</span>, scan_position: &amp;<span class="hljs-symbol">'a</span> ScanPosition) -&gt; <span class="hljs-built_in">Vec</span>&lt;ImageGroup&lt;<span class="hljs-symbol">'a</span>&gt;&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> image_dir = <span class="hljs-keyword">self</span>.image_dir.clone();</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>We assume that images are stored under the root image dir with a path: <code>&lt;root image
dir&gt;/&lt;scan position name&gt;/&lt;image name&gt;.irb</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        image_dir.push(&amp;scan_position.name);
        <span class="hljs-keyword">match</span> fs::read_dir(image_dir) {
            <span class="hljs-literal">Ok</span>(read_dir) =&gt; {
                read_dir</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Use filter_map to both (a) discard any files that we don’t like and (b)
convert file paths to <code>ImageGroup</code>s.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    .filter_map(|entry| {
                        <span class="hljs-keyword">let</span> entry = entry.unwrap();</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Only trust files with an “irb” extension.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> entry.path().extension().map(|e| e == <span class="hljs-string">"irb"</span>).unwrap_or(
                            <span class="hljs-literal">false</span>,
                        )
                        {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>The <strong>riscan-pro</strong> crate contains some logic to deduce scan position
images from file paths, and we trust that logic here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">let</span> image = scan_position.image_from_path(entry.path()).unwrap();
                            <span class="hljs-keyword">let</span> irb = Irb::from_path(entry.path().to_string_lossy().as_ref())
                                .unwrap();
                            <span class="hljs-keyword">let</span> camera_calibration =
                                image.camera_calibration(&amp;<span class="hljs-keyword">self</span>.project).unwrap();
                            <span class="hljs-keyword">let</span> mount_calibration = image.mount_calibration(&amp;<span class="hljs-keyword">self</span>.project).unwrap();
                            <span class="hljs-literal">Some</span>(ImageGroup {
                                camera_calibration: camera_calibration,
                                image: image,
                                irb: irb,
                                mount_calibration: mount_calibration,
                                rotate: <span class="hljs-keyword">self</span>.rotate,
                            })
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-literal">None</span>
                        }
                    })
                    .collect()
            }
            <span class="hljs-literal">Err</span>(err) =&gt; {
                <span class="hljs-keyword">use</span> std::io::ErrorKind;
                <span class="hljs-keyword">match</span> err.kind() {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>If the directory didn’t exist, we just assume that there are no images for
this scan position and carry on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ErrorKind::NotFound =&gt; <span class="hljs-built_in">Vec</span>::new(),
                    _ =&gt; <span class="hljs-built_in">panic!</span>(<span class="hljs-string">"io error: {}"</span>, err),
                }
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Computes the output las file for the provided scan position, infile, and the configured las
directory.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">outfile</span></span>&lt;P: <span class="hljs-built_in">AsRef</span>&lt;Path&gt;&gt;(&amp;<span class="hljs-keyword">self</span>, scan_position: &amp;ScanPosition, infile: P) -&gt; PathBuf {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> outfile = <span class="hljs-keyword">self</span>.las_dir.clone();
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.use_scanpos_names {
            outfile.push(Path::new(&amp;scan_position.name).with_extension(<span class="hljs-string">"las"</span>));
        } <span class="hljs-keyword">else</span> {
            outfile.push(infile.as_ref().with_extension(<span class="hljs-string">"las"</span>).file_name().unwrap());
        }
        outfile
    }
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>&gt; ImageGroup&lt;<span class="hljs-symbol">'a</span>&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>This is the import bits, where a SOCS point is converted into a temperature.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">temperature</span></span>(&amp;<span class="hljs-keyword">self</span>, socs: &amp;Point&lt;Socs&gt;) -&gt; <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">f64</span>&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>There is always a valid CMCS (CaMera’s Coordiante System) point for a given SOCS point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> cmcs = socs.to_cmcs(<span class="hljs-keyword">self</span>.image.cop, <span class="hljs-keyword">self</span>.mount_calibration);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>A CMCS point cannot always be mapped onto a pixel, e.g.:</p>
<ol>
<li>The CMCS point is behind the camera.</li>
<li>The CMCS point is outside of the angle masks, as specified in the RiSCAN Pro project
configuration.</li>
<li>The computed pixel coordinates are outside of the bounds of the image.</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">self</span>.camera_calibration.cmcs_to_ics(&amp;cmcs).map(|(<span class="hljs-keyword">mut</span> u,
          <span class="hljs-keyword">mut</span> v)| {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>A 90° rotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.rotate {
                <span class="hljs-keyword">let</span> new_u = <span class="hljs-keyword">self</span>.camera_calibration.height <span class="hljs-keyword">as</span> <span class="hljs-built_in">f64</span> - v;
                v = u;
                u = new_u;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Look up the pixel in the image to get the temperature in Kelvin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">self</span>.irb
                .temperature(u.trunc() <span class="hljs-keyword">as</span> <span class="hljs-built_in">i32</span>, v.trunc() <span class="hljs-keyword">as</span> <span class="hljs-built_in">i32</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Convert Kelvin to Celsius.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                .expect(<span class="hljs-string">"error when retrieving temperature"</span>) - <span class="hljs-number">273.15</span>
        })
    }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Fin.</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
